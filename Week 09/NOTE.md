学习笔记
### HTML 解析
对输入的字符，使用有限状态机(FSM)来解析，规定状态机的状态(简化了状态)
##### 标签解析
1、开始标签、结束标签、自封闭标签
2、创建元素token
3、在状态机中，除了状态迁移，还需要加入业务逻辑
4、在标签结束状态(>, 并不是结束标签)提交token

note: 关于自闭合标签，H5规范中不加/, 这里是用/来判断是否进入自闭合的状态，把开始标签和自闭合标签归为一类了。
##### 解析属性
1、单引号属性、双引号属性、无引号属性
2、创建属性键值/对 对象，在一个属性结束时提交属性对象

##### 构建DOM
1、基本技巧是使用栈，在标签开始时入栈，标签结束时出栈。初始栈为document 节点
2、自封闭标签可以视为入栈立刻出栈。
3、对于任何元素，栈顶元素就是它的父元素。

##### 添加文本节点
1、遇到文本节点，将文本节点放入栈顶元素的children中
2、合并当前文本节点后面的所有文本节点

### CSS 计算

##### 收集CSS规则
1、在遇到style标签结束时，使用css模块来解析style里面的文本，拿到rules

##### 调用CSS计算函数
1、当创建一个元素时，立即计算css
2、理论上，当分析一个元素时，css规则已经收集完毕
3、忽略body中有style的情况

note: 真实浏览器中，body中可能有style标签，需要重新计算css

##### 获取父元素序列
1、需要找到所有的父元素才能判断元素是否和父元素匹配
2、栈里面的元素就是当前元素的所有父元素(由栈顶向栈底)
3、浅复制一份栈，反转

##### 选择器匹配
1、选择由当前元素向外匹配
2、将复杂选择器拆成单个元素的选择器，循环匹配父元素队列

##### 计算选择与元素匹配
1、根据选择器的类型和元素的属性，计算选择器是否和元素匹配

note: 这里只实现了tag class id 实际浏览器更复杂
##### 生成computedStyle
基于上一步的匹配结果，如果匹配成功，生成computedStyle
##### 计算specificity
1、根绝选择器优先来决定是否覆盖css属性
2、不同的选择器有不同的优先级，通过一个四元组来保存不同选择器的权重。
3、越往左边权重越高，优先级也就越高。
4、如果高位的权重更高，就不用比较低位的权重了
